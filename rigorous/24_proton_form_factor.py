#!/usr/bin/env python3
"""
24. СРАВНЕНИЕ ФОРМ-ФАКТОРОВ: Кварки vs Узел

Цель: Проверить, какая модель лучше описывает электрический форм-фактор протона.

Метод:
  1. Кварковая модель: экспоненциальная плотность (дипольный форм-фактор)
  2. Узловая модель: плотность трефойля (3 лепестка)
  3. Сравнение с экспериментом (PRad, Jefferson Lab)

Простая геометрия, без сложных вычислений.
"""

import numpy as np
import math

print("="*70)
print("ФОРМ-ФАКТОР ПРОТОНА: Кварки vs Узел")
print("="*70)

# =============================================================================
# §1. ЭКСПЕРИМЕНТАЛЬНЫЕ ДАННЫЕ
# =============================================================================

print("\n§1. Экспериментальные данные (PRad 2019)")
print("-"*40)

# Дипольный форм-фактор (стандартная параметризация)
# G_E(Q²) = 1 / (1 + Q²/Λ²)²
# Λ² = 0.71 GeV² (из эксперимента)

Lambda2_exp = 0.71  # GeV²
r_p_exp = 0.8414    # fm (радиус протона, PRad 2019)

print(f"Дипольный параметр Λ² = {Lambda2_exp} GeV²")
print(f"Зарядовый радиус r_p = {r_p_exp} fm")

# Связь: r² = 12/Λ² (для дипольного форм-фактора)
r_from_dipole = np.sqrt(12 / Lambda2_exp) * 0.197  # GeV⁻¹ → fm
print(f"r из дипольной формулы: {r_from_dipole:.4f} fm")

# =============================================================================
# §2. КВАРКОВАЯ МОДЕЛЬ (Дипольный форм-фактор)
# =============================================================================

print("\n§2. Кварковая модель")
print("-"*40)

def G_E_dipole(Q2, Lambda2=0.71):
    """
    Дипольный форм-фактор.
    G_E(Q²) = 1 / (1 + Q²/Λ²)²
    
    Физический смысл: экспоненциальная плотность заряда.
    """
    return 1.0 / (1 + Q2/Lambda2)**2

print("G_E(Q²) = 1 / (1 + Q²/Λ²)²")
print("Плотность: ρ(r) ~ exp(-r/a), три кварка как точки")

# =============================================================================
# §3. УЗЛОВАЯ МОДЕЛЬ (Трефойль)
# =============================================================================

print("\n§3. Узловая модель (Трефойль)")
print("-"*40)

def G_E_trefoil(Q2, r0=0.84):
    """
    Форм-фактор для плотности трефойля.
    
    Простейшая модель: плотность сконцентрирована на тороидальной трубке
    с тремя витками (трефойль).
    
    Аппроксимация: Гауссиан × осцилляции от 3 лепестков
    G_E(Q²) ≈ exp(-Q²r₀²/6) × (1 + cos(Q·r₀·√3)/2)
    
    r0 — характерный размер узла (≈ радиус протона)
    """
    # Основной гауссиан (размер узла)
    gauss = np.exp(-Q2 * r0**2 / 6)
    
    # Модуляция от 3 лепестков (интерференция)
    # Расстояние между лепестками ~ r0 × √3 / 2
    Q = np.sqrt(Q2) if Q2 > 0 else 0
    d_lobe = r0 * np.sqrt(3) / 2  # расстояние между центрами лепестков
    modulation = (2 + np.cos(Q * d_lobe * 0.197)) / 3  # 0.197 = ћc в GeV·fm
    
    return gauss * modulation

print("G_E(Q²) ≈ exp(-Q²r₀²/6) × (2 + cos(Q·d))/3")
print("Плотность: тороидальная трубка с 3 витками (трефойль)")
print(f"Характерный размер r₀ = {r_p_exp} fm")

# =============================================================================
# §4. СРАВНЕНИЕ МОДЕЛЕЙ
# =============================================================================

print("\n§4. Сравнение моделей")
print("-"*40)

# Диапазон Q² (типичный для экспериментов)
Q2_values = [0.01, 0.05, 0.1, 0.2, 0.5, 1.0, 2.0]

print(f"{'Q² (GeV²)':<12} {'Дипольный':<12} {'Трефойль':<12} {'Разница %':<12}")
print("-"*48)

for Q2 in Q2_values:
    g_dip = G_E_dipole(Q2)
    g_tre = G_E_trefoil(Q2)
    diff_pct = (g_tre - g_dip) / g_dip * 100 if g_dip > 0 else 0
    print(f"{Q2:<12.2f} {g_dip:<12.4f} {g_tre:<12.4f} {diff_pct:<+12.1f}")

# =============================================================================
# §5. КЛЮЧЕВОЕ ОТЛИЧИЕ: ОСЦИЛЛЯЦИИ
# =============================================================================

print("\n§5. Ключевое отличие: осцилляции")
print("-"*40)

print("""
КВАРКОВАЯ МОДЕЛЬ:
  - Монотонное убывание G_E(Q²)
  - Нет осцилляций
  - Три точечных заряда → нет интерференции в форм-факторе

УЗЛОВАЯ МОДЕЛЬ:
  - Осцилляции в G_E(Q²) при Q² > 1 GeV²
  - Причина: интерференция от 3 лепестков трефойля
  - Период осцилляций ~ 2π/(d·0.197) ≈ 2-3 GeV²

ПРЕДСКАЗАНИЕ:
  Если узловая модель верна, должны быть ОСЦИЛЛЯЦИИ 
  форм-фактора при Q² = 2-5 GeV².
  
  Эксперимент: Jefferson Lab 12 GeV (данные 2020+)
""")

# =============================================================================
# §6. ЧИСЛЕННАЯ ПРОВЕРКА: χ² ДЛЯ ОБЕИХ МОДЕЛЕЙ
# =============================================================================

print("\n§6. Простая проверка (псевдо-данные)")
print("-"*40)

# Псевдо-экспериментальные точки (близко к реальным данным PRad)
exp_data = [
    (0.01, 0.986, 0.005),  # (Q², G_E, ошибка)
    (0.05, 0.932, 0.008),
    (0.10, 0.870, 0.010),
    (0.20, 0.765, 0.012),
    (0.50, 0.545, 0.015),
    (1.00, 0.330, 0.020),
]

chi2_dipole = 0
chi2_trefoil = 0

for Q2, G_exp, err in exp_data:
    g_dip = G_E_dipole(Q2)
    g_tre = G_E_trefoil(Q2)
    
    chi2_dipole += ((G_exp - g_dip) / err)**2
    chi2_trefoil += ((G_exp - g_tre) / err)**2

ndf = len(exp_data) - 1  # degrees of freedom

print(f"χ²/ndf (Дипольный): {chi2_dipole:.2f} / {ndf} = {chi2_dipole/ndf:.2f}")
print(f"χ²/ndf (Трефойль):  {chi2_trefoil:.2f} / {ndf} = {chi2_trefoil/ndf:.2f}")

if chi2_trefoil < chi2_dipole:
    print("\n→ Трефойль описывает данные ЛУЧШЕ")
else:
    print("\n→ Дипольный описывает данные лучше (ожидаемо для низких Q²)")

# =============================================================================
# §7. СВЯЗЬ С МАССОЙ ПРОТОНА
# =============================================================================

print("\n§7. Связь с массой протона")
print("-"*40)

pi = math.pi
S_geo = 4*pi**3 + pi**2 + pi
S_vac = S_geo - 1/(24*S_geo) - 1/(pi**4 * S_geo**2)

# Масса протона в единицах m_e
mu_theory = 6*pi**5 + 3*pi/(2*S_vac) + (3 + 1/pi)/S_vac**2
mu_codata = 1836.15267343

print(f"μ (теория)  = {mu_theory:.8f}")
print(f"μ (CODATA)  = {mu_codata:.8f}")
print(f"Разница     = {(mu_theory - mu_codata)/mu_codata * 1e9:.2f} ppb")

print("""
ИНТЕРПРЕТАЦИЯ 6π⁵:

Кварковая:  3 × Vol(SU(3)) = 3 × 2π⁵ = 6π⁵
            Три кварка, каждый "несёт" объём цветового пространства.

Узловая:    E(трефойль) ∝ 6π⁵
            Энергия минимальной конфигурации H=3 узла.

ЧИСЛЕНО ОДИНАКОВО → нужен форм-фактор для различения!
""")

# =============================================================================
# §8. ВЫВОДЫ
# =============================================================================

print("\n" + "="*70)
print("ВЫВОДЫ")
print("="*70)

print("""
1. ПОДТВЕРЖДЕНО:
   - Формула μ = 6π⁵ + ... даёт массу протона с точностью < 1 ppb
   - Это факт, независимый от интерпретации (кварки или узел)

2. НЕ РАЗЛИЧИМО ЧИСЛЕННО:
   - 6π⁵ = 3 × 2π⁵ (кварки) = E(H=3 узел)
   - Обе интерпретации дают одно число

3. СПОСОБ РАЗЛИЧЕНИЯ:
   - Форм-фактор G_E(Q²) при высоких Q² (> 2 GeV²)
   - Узловая модель предсказывает ОСЦИЛЛЯЦИИ
   - Кварковая модель — монотонное убывание

4. ЭКСПЕРИМЕНТ:
   - Jefferson Lab 12 GeV имеет данные до Q² ~ 8 GeV²
   - Нужно проверить наличие осцилляций

СТАТУС: Гипотеза проверяема, но требует анализа высоко-Q² данных.
""")
