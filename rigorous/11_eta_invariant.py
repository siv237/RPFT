#!/usr/bin/env python3
"""
Численное вычисление η-инварианта для оператора Дирака на L(2,1) = RP³.

η(s) = Σ sign(λ_n) |λ_n|^{-s}
η(0) = lim_{s→0} η(s) — регуляризованная разность положительных и отрицательных собственных значений.

Спектр Дирака на L(2,1) (Bär 1996):
- Собственные значения: ±(n + 3/2) для n = 0, 1, 2, ...
- Кратность: 2(n+1)(n+2)
- На L(2,1) с тривиальной spin-структурой: только нечётные n

Навигация:
  ← 10_a2_coefficient.md | README.md →
  Главная: 00_main.md
"""

from mpmath import mp, nsum, diff, pi, inf, sign, fabs, zeta as mpzeta
mp.dps = 50

print("="*70)
print("ВЫЧИСЛЕНИЕ η-ИНВАРИАНТА ДЛЯ ДИРАКА НА L(2,1)")
print("="*70)

# =============================================================================
# §1. СПЕКТР ДИРАКА НА S³
# =============================================================================

print("\n§1. Спектр Дирака на S³")
print("-"*40)

def dirac_eigenvalue_S3(n, R=1):
    """
    Собственные значения Дирака на S³.
    λ_n = ±(n + 3/2)/R для n = 0, 1, 2, ...
    """
    return (n + mp.mpf('1.5')) / R

def dirac_multiplicity_S3(n):
    """
    Кратность собственного значения на S³.
    d_n = 2(n+1)(n+2) для каждого знака.
    """
    return 2 * (n + 1) * (n + 2)

print("Спектр Дирака на S³ (первые 5 уровней):")
print("n\t|λ|\t\td_n")
for n in range(5):
    lam = dirac_eigenvalue_S3(n)
    d = dirac_multiplicity_S3(n)
    print(f"{n}\t{float(lam):.4f}\t\t{d}")

# =============================================================================
# §2. СПЕКТР ДИРАКА НА L(2,1) = RP³
# =============================================================================

print("\n§2. Спектр Дирака на L(2,1) с тривиальной spin-структурой")
print("-"*40)

print("""
По теореме Bär (1996):
- Тривиальная spin-структура (η=0): только нечётные n
- Нетривиальная spin-структура (η=1): только чётные n

RPFT использует тривиальную spin-структуру → нечётные n.
""")

def dirac_eigenvalue_L21(k, R=1):
    """
    Собственные значения Дирака на L(2,1) с тривиальной spin-структурой.
    n = 2k+1 (нечётные), λ = ±(n + 3/2)/R
    """
    n = 2*k + 1  # нечётные n
    return (n + mp.mpf('1.5')) / R

def dirac_multiplicity_L21(k):
    """
    Кратность на L(2,1).
    Для нечётных n: d_n = 2(n+1)(n+2), делим на 2 (факторизация Z_2)
    → d_n^{L21} = (n+1)(n+2)
    """
    n = 2*k + 1
    return (n + 1) * (n + 2)

print("Спектр Дирака на L(2,1) (первые 5 уровней, нечётные n):")
print("k\tn\t|λ|\t\td_n")
for k in range(5):
    n = 2*k + 1
    lam = dirac_eigenvalue_L21(k)
    d = dirac_multiplicity_L21(k)
    print(f"{k}\t{n}\t{float(lam):.4f}\t\t{d}")

# =============================================================================
# §3. ETA-ФУНКЦИЯ
# =============================================================================

print("\n§3. Eta-функция η(s)")
print("-"*40)

def eta_function_L21(s, N_max=200):
    """
    η(s) = Σ sign(λ) |λ|^{-s} × d
    
    Для Дирака: симметричный спектр λ и -λ с одинаковой кратностью.
    Следовательно: η(s) = Σ_n d_n [(+λ)^{-s} + (-λ)^{-s}] × sign
                        = Σ_n d_n λ^{-s} [1 - 1] = 0
    
    НО: это верно только если спектр точно симметричен.
    Для L(2,1) нужно проверить.
    """
    s = mp.mpf(s)
    total = mp.mpf(0)
    
    for k in range(N_max):
        n = 2*k + 1  # нечётные
        lam = n + mp.mpf('1.5')
        d = (n + 1) * (n + 2)
        
        # Положительные и отрицательные собственные значения
        # +λ с кратностью d/2, -λ с кратностью d/2
        # sign(+λ) = +1, sign(-λ) = -1
        # Вклад: (+1) × (d/2) × λ^{-s} + (-1) × (d/2) × λ^{-s} = 0
        
        # Но d может быть нечётным — проверим
        if d % 2 != 0:
            print(f"Warning: d_n = {d} нечётно для n = {n}")
        
        # Симметричный вклад = 0
        total += 0
    
    return total

print("Для симметричного спектра Дирака: η(s) = 0 для всех s")
print("Это следует из: sign(+λ) + sign(-λ) = 0")

# =============================================================================
# §4. ПРОВЕРКА СИММЕТРИИ СПЕКТРА
# =============================================================================

print("\n§4. Проверка симметрии спектра")
print("-"*40)

print("""
Оператор Дирака D = iγ·∇ антикоммутирует с γ⁵ (в 4D) или γ (в 3D):
    γD = -Dγ

Следствие: если ψ — собственный вектор с λ, то γψ — с -λ.
Кратности одинаковы → спектр симметричен → η(s) = 0 для всех s.
""")

# Но для L(2,1) может быть нюанс со spin-структурой

print("Проверка: спектр Дирака на L(2,1) симметричен?")
print("По Bär (1996): да, для любой spin-структуры спектр симметричен.")
print("→ η(0) = 0 для L(2,1)")

# =============================================================================
# §5. АЛЬТЕРНАТИВА: η-ИНВАРИАНТ ЧЕРЕЗ ГРАНИЦУ
# =============================================================================

print("\n§5. η-инвариант в APS теореме")
print("-"*40)

print("""
Теорема Atiyah-Patodi-Singer:
Для 4-многообразия W с границей ∂W = M:

    Index(D_W) = ∫_W Â - (η(M) + h)/2

где h = dim ker(D_M).

Для W = B⁴ (4-шар), ∂W = S³:
    η(S³) = 0 (спектр симметричен)

Для W = такое, что ∂W = RP³:
    Нужно найти 4-многообразие с границей RP³.
    Например: RP⁴ - B⁴ имеет границу S³ ∪ RP³...
    
Это сложно. Используем другой подход.
""")

# =============================================================================
# §6. СВЯЗЬ С ТОПОЛОГИЧЕСКИМ ЧЛЕНОМ
# =============================================================================

print("\n§6. Связь η с топологическим членом π")
print("-"*40)

print("""
ВЫВОД:
------
η(0) = 0 для L(2,1) с любой spin-структурой (симметрия спектра).

Это означает:
- η-инвариант НЕ даёт топологический член π напрямую.
- Член π должен иметь другое происхождение.

Альтернативы:
1. Ray-Singer torsion (не η)
2. Голономия / Wilson loop
3. Минимальное действие через систолу (феноменология)

ЧЕСТНЫЙ СТАТУС:
- η(L(2,1)) = 0 → не объясняет Z_top = π
- Нужен другой механизм
""")

# =============================================================================
# §7. RAY-SINGER TORSION
# =============================================================================

print("\n§7. Ray-Singer Torsion (альтернатива)")
print("-"*40)

print("""
Определение:
    log T_RS(M) = (1/2) Σ_k (-1)^k k ζ'_k(0)

где ζ_k(s) — дзета-функция лапласиана на k-формах.

Для L(p,q):
    T_RS(L(p,q)) зависит от p, q нетривиально.

Для L(2,1) = RP³:
    Нужен явный расчёт.
    
Формула Franz-Reidemeister для L(p,q):
    τ(L(p,q)) = Π_{j=1}^{(p-1)/2} |1 - e^{2πij/p}|^{-2}
    
Для p=2, q=1:
    τ(L(2,1)) = |1 - e^{iπ}|^{-2} = |1 - (-1)|^{-2} = |2|^{-2} = 1/4
    
log τ = log(1/4) = -2 log 2 ≈ -1.386

Это НЕ равно π или log π.
""")

tau_L21 = 1/4
log_tau = float(mp.log(tau_L21))
print(f"τ(L(2,1)) = 1/4")
print(f"log τ = {log_tau:.6f}")
print(f"π = {float(pi):.6f}")
print(f"log π = {float(mp.log(pi)):.6f}")
print(f"\nlog τ ≠ π и log τ ≠ log π")

# =============================================================================
# §8. ИТОГОВЫЙ ВЫВОД
# =============================================================================

print("\n" + "="*70)
print("ИТОГОВЫЙ ВЫВОД")
print("="*70)

print("""
1. η(L(2,1)) = 0 — симметрия спектра Дирака
2. log T_RS(L(2,1)) = -2 log 2 ≈ -1.386 — не равно π
3. Ни η, ни log T_RS не дают член π напрямую

СТАТУС Z_top = π:
-----------------
Геометрический факт L_sys = π остаётся верным.
Но ФИЗИЧЕСКОЕ обоснование Z_top = L_sys требует:
    - Либо феноменологического постулата
    - Либо механизма через Wilson loop / голономию
    - Либо другого топологического инварианта

Рекомендация: признать Z_top = π как МИНИМАЛЬНЫЙ топологический вклад
(систола — кратчайший нестягиваемый путь), без претензии на строгий вывод.
""")

print("="*70)
